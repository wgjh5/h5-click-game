<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>一起收拾新冠病毒</title>
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link type="text/css" rel="stylesheet" href="./css/game.css">
		<script type="text/javascript" src='./js/jquery-3.2.1.min.js'></script>
		<script type="text/javascript" src='./js/jquery-ui.js'></script>
	</head>
	<body>
		<div class = 'upper' fbx = "0">
			<div class = 'upper-name'></div>
			<div class = 'upper-timer endFadeOut'>00:20:00</div>
			<div class = 'upper-count endFadeOut' hidden>0</div>
			<div class = 'upper-hit endFadeOut' hidden></div>
			<div class = 'wash-tip endFadeOut' hidden>
				<div class = 'wash-circle'>
					<svg height="100%" width="100%">
					  	<circle cx="50%" cy="50%" r="calc(50% - 1px)" stroke="#7283FD" stroke-width="2px" fill="transparent"/>
					</svg>
				</div>
			</div>
			<div class = 'upper-start-count'>3</div>
			<div class = 'upper-tip'></div>
			<div class = 'upper-mask'>
				<img class = 'upper-loading-title' src = './img/loading-title.svg'>
				<img class = 'upper-loading-icon' src = './img/loading-icon.svg'>
				<div class = 'cover'>
					<div class = 'cover-icon'></div>
					<div class = 'cover-title'></div>
					<div class = 'cover-image'></div>
					<div class = 'cover-start-btn'></div>
				</div>
			</div>
		</div>
		<script type="module" src = './js/game.js?v=2'></script>
            
	</body>
	<script type="text/javascript">
		function enterH5(){
			MtaH5.clickStat('enterH5',{'adtag':""});
		}
			function clickStat(name){
						MtaH5.clickStat(name);
					}


			var bgm0 = document.getElementById('bgm0');
			var bgm1 = document.getElementById('bgm1');
			var ahahah = document.getElementById('ahahah');

			var isPlay = 0;
			var bgm1IsFirst = true;

			document.addEventListener("WeixinJSBridgeReady", function () {
		    	bgm0.load();
		    	bgm1.load();
		    	ahahah.load();
		  	}, false);

			bgm0.addEventListener("timeupdate", function () { //播放时间改变   这个会一直打印
       			if (bgm0.duration - bgm0.currentTime < 3 && isPlay == 0) { 
       				window.setTimeout(function(){
       					if (bgm1IsFirst){
	       					window.setTimeout(function(){ bgm1.play(); }, 100);
	       					bgm1IsFirst = false;
       					} else 
							bgm1.play(); 
       				}, (bgm0.duration - bgm0.currentTime - 1.44) * 1000);
       				isPlay = 1; 
       			}
    		});

			bgm1.addEventListener("timeupdate", function () { //播放时间改变   这个会一直打印
       			if (bgm1.duration - bgm1.currentTime < 3 && isPlay == 1) { 
       				window.setTimeout(function(){
       					bgm0.play(); 
       				}, (bgm1.duration - bgm1.currentTime - 1.44) * 1000);
       				isPlay = 0; 
       			}
    		});

    		function hitAudio(count){
    			document.getElementById('hit'+count % 5).volume = 0.3;
				document.getElementById('hit'+count % 5).play();
    		}

    		function ahahahPlay(){
    			ahahah.play();
    		}

    		function loadAudio(){		
				bgm0.play();
				document.getElementById('hit0').load();
				document.getElementById('hit1').load();
				document.getElementById('hit2').load();
				document.getElementById('hit3').load();
				document.getElementById('hit4').load();
				ahahah.load();
    		}

		  	var tid, vid;

		  	var endingDesArray = [
			  	'用收拾前任的力气',
			  	'用上网抢菜的手速',
			  	'用天天刷碗的臂力',
			  	'用接老板电话的手速',
			  	'用进阶厨神的巧手',
			  	'用复工起床的力气',
			  	'用视频会议前化妆的手速',
			  	'用在客厅跑马拉松的耐力',
			  	'用一手办公一手带娃的技能',
			  	'用疫情不退誓不聚会的决心',
			  	'用宅家刷剧的定力',
			  	'用下单口罩的手速',
			  	'用陪孩子上网课的毅力',
			  	'用在家憋疯的洪荒之力'
		  	];

		  	var isStart = false;

			function reset(){
				if (!isStart){
					isStart = true;
					window.setTimeout(function(){ enterH5(); }, 500);
				}
				$('.ending').hide();
				tid = Math.floor(Math.random() * 14);
				vid = Math.floor(Math.random() * 14);
				$('.ending-tip').css('background-image','url(https://baike-med-1256891581.file.myqcloud.com/yidian/production/operation/draw_virus/ossweb-img/ending-tip-'+tid+'.svg?v=1)');
				$('.ending-virus').css('background-image','url(https://baike-med-1256891581.file.myqcloud.com/yidian/production/operation/draw_virus/ossweb-img/ending-virus-'+vid+'.png)');
				$('.ending-box').attr('vid',vid);
				$('.ending-des-random').text(endingDesArray[tid]);
				let iframe = "<iframe src = 'game.html?v=5'></iframe>";
				$('#viewer').html(iframe);
			}

			function clickStat(name){
				MtaH5.clickStat(name);
			}

			reset();

			function showEnding(){
				MtaH5.clickStat('showEnding');
				$('.ending').fadeIn(1000);
			}

			function hitsCount(my, all){
				MtaH5.clickStat('gameFinish', {'count':my});
				$('.ending-my-count').text(my);
				$('.ending-all-count').text(all);
				$.ajax({
					url:'screenshot.php?tid='+tid+'&vid='+vid+'&my='+my+'&all='+all+'&name='+encodeURI($('.ending-name').text()),
					type:'get',
					success:function(res){
						$('.share-img').attr('src',res);
					}
				});
			}
	</script>
	
	
<!-- 	<script>
	$(function(){
	
	    function wx_share(){
	        wx.onMenuShareTimeline({
	            title: '一起收拾新冠病毒',
	            link: '', //公眾平台的js安全域名
	            imgUrl: '',//請使用絕對路徑
	            success: function () {MtaH5.clickShare('wechat_moments');},cancel: function () {}
	        });
	        wx.onMenuShareAppMessage({
	            title: '一起收拾新冠病毒', 
	            desc: '来一记暴击',
	            link: '', 
	            imgUrl: '',
	            success: function () {MtaH5.clickShare('wechat_friend');},cancel: function () {}
	        });
	    }
	
	
	    $.ajax({
			url: '/api/access/json?cmd=SignForJsSDK',
	    	type: "post",//传递方法
	        data: JSON.stringify({
	        	"header": {
	        		"version":2,
	        		"flag":0
	        	},
	        	"body": {
	        		"seq":1,
	        		"cmd":"SignForJsSDK",
	        		"token":"",
	        		"client": {
	        			"version":"1.0.0",
	        			"platform":1,
	        			"os":1,
	        			"env":"",
	        			"isTourist":[48],
	        			"adtag":"",
	        			"vnk":"",
	        			"product":0
	        		},
	        		"payload": {
	        			"url":location.href.split('#')[0],
	        			"appid":""
	        		}
	        	}
	        }),
	        dataType: "json",
	        headers: {
			    'content-type': 'application/json', // 默认值
			    Authorization: 'Bearer', // 不能是'Bearer ',ios9设置header有bug
			},
			success:function(result){
			   let body = result&&result.body;
			    if (body&&body.retcode == 0 && body.bizcode == 0) {
			    	let payload = body.payload;
					wx.config({
						debug: false,
						appId: payload.appid,
						timestamp: payload.timestamp,
						nonceStr: payload.noncestr,
						signature: payload.signature,
						jsApiList: ['onMenuShareTimeline','onMenuShareAppMessage']
					});
					wx.ready(function () {
						wx_share();
					});
			    }
					  		
			}
		});
	});
	</script>
	<script>
		var _mtac = {"performanceMonitor":1,"senseQuery":1};
	  	(function() {
	  		var mta = document.createElement("script");
	  		mta.src = "//pingjs.qq.com/h5/stats.js?v2.0.4";
	  		mta.setAttribute("name", "MTAH5");
	  		mta.setAttribute("sid", "500711408");
	  		mta.setAttribute("cid", "500711409");
	  		var s = document.getElementsByTagName("script")[0];
	  		s.parentNode.insertBefore(mta, s);
	  	})();
	</script> -->
</html>